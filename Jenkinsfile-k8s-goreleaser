pipeline {
    agent none
    stages {
        stage('Run Tests') {
            parallel {
                stage('Release') {
                    agent {
                        kubernetes {
                            label 'jenkins-linux-slave'
                            yamlFile 'JenkinsKubernetesPodLinux.yaml'
                            nodeSelector 'kubernetes.io/os=linux'
                        }
                    }
                    environment {
                        GITHUB_TOKEN = credentials('jenkins_github_token')
                        GOPATH = './app'
                        PROJECT = 'create binaries'
                    }
                    steps {
                        // The needed steps to create the binaries
                        container('goreleaser') {
                            sh """
                                export GITHUB_TOKEN=741c7ae024ee684e60df8c7a8aed9b53d85eb194
                                echo Workspace dir is ${pwd()}
                                sleep 100000
                                goreleaser release --skip-publish --rm-dist

                                #curl -sL https://git.io/goreleaser | bash
                            """
                        }
                    }
                }
                stage('echo busybox') {
                    agent {
                        kubernetes {
                            label 'jenkins-linux-slave'
                            yamlFile 'JenkinsKubernetesPodLinux.yaml'
                        }
                    }
                    steps {
                        // The needed steps for your testing
                        container('busybox') {
                            sh """
                                echo hello
                            """
                        }
                    }
                }
            }
        }
    }
}